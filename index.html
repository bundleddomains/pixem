<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Rat Layout Tool</title>
<style>
body{
  margin:0;
  background:#000;
  overflow:hidden;
  font-family:monospace;
  color:#0f0;
}

.rat{
  position:absolute;
  cursor:grab;
  user-select:none;
  touch-action:none;
}

.panel{
  position:fixed;
  bottom:20px;
  left:20px;
  background:#111;
  border:1px solid #333;
  padding:12px;
  width:320px;
}

textarea{
  width:100%;
  height:100px;
  background:#000;
  color:#0f0;
  border:1px solid #333;
}

button{
  margin-top:6px;
  width:100%;
  background:#000;
  color:#0f0;
  border:1px solid #333;
  padding:6px;
}
</style>
</head>
<body>

<img src="rat1.png" class="rat" data-id="rat1" style="top:100px;left:100px;width:200px;">
<img src="rat2.png" class="rat" data-id="rat2" style="top:250px;left:300px;width:200px;">

<div class="panel">
  Layout JSON
  <textarea id="layoutData"></textarea>
  <button onclick="exportLayout()">Export</button>
  <button onclick="importLayout()">Import</button>
</div>

<script>

let highestZ = 1;

function makeDraggable(el){
  let offsetX, offsetY;

  function start(e){
    e.preventDefault();
    el.style.zIndex = ++highestZ;

    const rect = el.getBoundingClientRect();
    const clientX = e.touches ? e.touches[0].clientX : e.clientX;
    const clientY = e.touches ? e.touches[0].clientY : e.clientY;

    offsetX = clientX - rect.left;
    offsetY = clientY - rect.top;

    document.addEventListener("mousemove", move);
    document.addEventListener("touchmove", move, {passive:false});
    document.addEventListener("mouseup", stop, {once:true});
    document.addEventListener("touchend", stop, {once:true});
  }

  function move(e){
    e.preventDefault();
    const clientX = e.touches ? e.touches[0].clientX : e.clientX;
    const clientY = e.touches ? e.touches[0].clientY : e.clientY;

    el.style.left = (clientX - offsetX) + "px";
    el.style.top  = (clientY - offsetY) + "px";
  }

  function stop(){
    document.removeEventListener("mousemove", move);
    document.removeEventListener("touchmove", move);
  }

  el.addEventListener("mousedown", start);
  el.addEventListener("touchstart", start, {passive:false});
}

document.querySelectorAll(".rat").forEach(makeDraggable);

function exportLayout(){
  const data = [];
  document.querySelectorAll(".rat").forEach(el=>{
    data.push({
      id: el.dataset.id,
      top: el.style.top,
      left: el.style.left,
      width: el.style.width,
      z: el.style.zIndex || 1
    });
  });
  document.getElementById("layoutData").value =
    JSON.stringify(data, null, 2);
}

function importLayout(){
  const input = document.getElementById("layoutData").value;
  try{
    const data = JSON.parse(input);
    data.forEach(item=>{
      const el = document.querySelector(`[data-id="${item.id}"]`);
      if(el){
        el.style.top = item.top;
        el.style.left = item.left;
        el.style.width = item.width;
        el.style.zIndex = item.z;
      }
    });
  }catch(e){
    alert("Invalid JSON");
  }
}

</script>
</body>
</html>
